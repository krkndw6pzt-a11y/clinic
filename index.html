<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>عيادة الدكتور كنان المرسومي</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0d6efd">
<link rel="manifest" href="manifest.json">

<style>
body {font-family: Arial, sans-serif; background:#f5f7fa; margin:0}
header {background:#0d6efd; color:white; padding:15px; text-align:center; font-size:20px}
.container {padding:15px}
.card {background:white; border-radius:10px; padding:15px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1)}
label {display:block; margin-top:10px}
input {width:100%; padding:8px; margin-top:5px}
button {margin-top:15px; width:100%; padding:10px; font-size:16px; border:none; border-radius:8px}
.save {background:#198754; color:white}
.go {background:#0d6efd; color:white}
.back {background:#6c757d; color:white}
.hidden {display:none}
table {width:100%; border-collapse:collapse; margin-top:10px}
th,td {border:1px solid #ddd; padding:6px; text-align:center}
th {background:#eef}
</style>
</head>
<body>

<header>عيادة الدكتور كنان المرسومي</header>

<div class="container">

<div id="inputPage" class="card">
<h3>إدخال البيانات اليومية</h3>

<label>التاريخ</label>
<input type="date" id="date">

<label>مجموع المرضى</label>
<input type="number" id="total">

<label>زيارة أولى</label>
<input type="number" id="first">

<label>بدون حجز</label>
<input type="number" id="walk">

<button class="save" onclick="saveData()">حفظ</button>
<button class="go" onclick="showReports()">التقارير</button>
</div>

<div id="reportPage" class="card hidden">
<h3>التقارير</h3>

<div id="summary"></div>
<div id="table"></div>

<button class="back" onclick="showInput()">رجوع</button>
</div>

</div>

<script>
date.valueAsDate = new Date();

function getAll(){
  return JSON.parse(localStorage.getItem("clinicData") || "{}");
}

function saveAll(data){
  localStorage.setItem("clinicData", JSON.stringify(data));
}

function saveData(){
  const d = date.value;
  if(!d){ alert("اختاري تاريخ"); return; }

  const data = getAll();
  data[d] = {
    total: Number(total.value||0),
    first: Number(first.value||0),
    walk: Number(walk.value||0)
  };
  saveAll(data);
  alert("تم الحفظ");
}

function showReports(){
  const data = getAll();
  let sumT=0, sumF=0, sumW=0;
  let rows = "";

  Object.keys(data).sort().forEach(d=>{
    sumT+=data[d].total;
    sumF+=data[d].first;
    sumW+=data[d].walk;
    rows += `
      <tr>
        <td>${d}</td>
        <td>${data[d].total}</td>
        <td>${data[d].first}</td>
        <td>${data[d].walk}</td>
      </tr>`;
  });

  summary.innerHTML = `
    <p><b>المجموع الكلي:</b></p>
    مجموع المرضى: ${sumT}<br>
    زيارة أولى: ${sumF}<br>
    بدون حجز: ${sumW}
  `;

  table.innerHTML = `
    <table>
      <tr>
        <th>التاريخ</th>
        <th>مجموع المرضى</th>
        <th>زيارة أولى</th>
        <th>بدون حجز</th>
      </tr>
      ${rows}
    </table>
  `;

  inputPage.classList.add("hidden");
  reportPage.classList.remove("hidden");
}

function showInput(){
  reportPage.classList.add("hidden");
  inputPage.classList.remove("hidden");
}

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
